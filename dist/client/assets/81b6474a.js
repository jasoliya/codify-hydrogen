import{r as y,C as v,j as $}from"./index.cf70f272.js";import{f as G}from"./92add5bc.js";import{u as K,C as Y,a as H,b as J,c as W,d as X,e as Z,f as B,g as L,h as F,i as tt}from"./5d366af3.js";import{C as rt,a as et}from"./2d57a4bb.js";import"./ce1402c4.js";import"./4592c789.js";import"./3f1ae3a0.js";import"./920a254b.js";import"./d6282b27.js";const _="shopifyCartId";function at(r,i){switch(i.type){case"cartFetch":{if(r.status==="uninitialized")return{status:"fetching"};break}case"cartCreate":{if(r.status==="uninitialized")return{status:"creating"};break}case"resolve":{if(["updating","fetching","creating"].includes(r.status))return{status:"idle",cart:i.cart};break}case"reject":{if(i.errors){console.group("%cCart Error:","color:red");for(const[o,b]of i.errors.entries())console.log(`%c${o+1}. `+b.message,"color:red");console.groupEnd()}if(r.status==="fetching"||r.status==="creating")return{status:"uninitialized",error:i.errors};if(r.status==="updating")return{status:"idle",cart:r.lastValidCart,error:i.errors};break}case"resetCart":{if(r.status==="fetching")return{status:"uninitialized"};break}case"addLineItem":{if(r.status==="idle")return{status:"updating",cart:r.cart,lastValidCart:r.cart};break}case"removeLineItem":{if(r.status==="idle")return{status:"updating",cart:{...r.cart,lines:r.cart.lines.filter(({id:o})=>!i.lines.includes(o))},lastValidCart:r.cart};break}case"updateLineItem":{if(r.status==="idle")return{status:"updating",cart:{...r.cart,lines:r.cart.lines.map(o=>{const b=i.lines.find(({id:I})=>I===o.id);return b&&b.quantity?{...o,quantity:b.quantity}:o})},lastValidCart:r.cart};break}case"noteUpdate":{if(r.status==="idle")return{status:"updating",cart:r.cart,lastValidCart:r.cart};break}case"buyerIdentityUpdate":{if(r.status==="idle")return{status:"updating",cart:r.cart,lastValidCart:r.cart};break}case"cartAttributesUpdate":{if(r.status==="idle")return{status:"updating",cart:r.cart,lastValidCart:r.cart};break}case"discountCodesUpdate":{if(r.status==="idle")return{status:"updating",cart:r.cart,lastValidCart:r.cart};break}}throw new Error(`Cannot dispatch event (${i.type}) for current cart state (${r.status})`)}function ot({children:r,numCartLines:i,onCreate:o,onLineAdd:b,onLineRemove:I,onLineUpdate:k,onNoteUpdate:x,onBuyerIdentityUpdate:w,onAttributesUpdate:U,onDiscountCodesUpdate:q,data:C,cartFragment:p=tt,customerAccessToken:h,countryCode:l=et.Us}){var N,P;l&&(l=l.toUpperCase());const m=C?{status:"idle",cart:n(C)}:{status:"uninitialized"},[c,u]=y.exports.useReducer((e,a)=>at(e,a),m),f=K(),A=c.status==="idle"&&l!==((P=(N=c==null?void 0:c.cart)==null?void 0:N.buyerIdentity)==null?void 0:P.countryCode)&&!c.error,R=y.exports.useCallback(async e=>{u({type:"cartFetch"});const{data:a}=await f({query:Y(p),variables:{id:e,numCartLines:i,country:l}});if(!(a!=null&&a.cart)){window.localStorage.removeItem(_),u({type:"resetCart"});return}u({type:"resolve",cart:n(a.cart)})},[f,p,i,l]),j=y.exports.useCallback(async e=>{var t,d,Q;u({type:"cartCreate"}),o==null||o(),l&&!((t=e.buyerIdentity)!=null&&t.countryCode)&&(e.buyerIdentity==null&&(e.buyerIdentity={}),e.buyerIdentity.countryCode=l),h&&!((d=e.buyerIdentity)!=null&&d.customerAccessToken)&&(e.buyerIdentity==null&&(e.buyerIdentity={}),e.buyerIdentity.customerAccessToken=h);const{data:a,errors:s}=await f({query:H(p),variables:{input:e,numCartLines:i,country:l}});s&&u({type:"reject",errors:s}),(Q=a==null?void 0:a.cartCreate)!=null&&Q.cart&&(e.lines&&v.publish(v.eventNames.ADD_TO_CART,!0,{addedCartLines:e.lines,cart:a.cartCreate.cart}),u({type:"resolve",cart:n(a.cartCreate.cart)}),window.localStorage.setItem(_,a.cartCreate.cart.id))},[o,l,f,p,i,h]),g=y.exports.useCallback(async(e,a)=>{var s;if(a.status==="idle"){u({type:"addLineItem"}),b==null||b();const{data:t,errors:d}=await f({query:J(p),variables:{cartId:a.cart.id,lines:e,numCartLines:i,country:l}});d&&u({type:"reject",errors:d}),(s=t==null?void 0:t.cartLinesAdd)!=null&&s.cart&&(v.publish(v.eventNames.ADD_TO_CART,!0,{addedCartLines:e,cart:t.cartLinesAdd.cart}),u({type:"resolve",cart:n(t.cartLinesAdd.cart)}))}},[b,f,p,i,l]),D=y.exports.useCallback(async(e,a)=>{var s;if(a.status==="idle"){u({type:"removeLineItem",lines:e}),I==null||I();const{data:t,errors:d}=await f({query:W(p),variables:{cartId:a.cart.id,lines:e,numCartLines:i,country:l}});d&&u({type:"reject",errors:d}),(s=t==null?void 0:t.cartLinesRemove)!=null&&s.cart&&(v.publish(v.eventNames.REMOVE_FROM_CART,!0,{removedCartLines:e,cart:t.cartLinesRemove.cart}),u({type:"resolve",cart:n(t.cartLinesRemove.cart)}))}},[I,f,p,i,l]),V=y.exports.useCallback(async(e,a)=>{var s;if(a.status==="idle"){u({type:"updateLineItem",lines:e}),k==null||k();const{data:t,errors:d}=await f({query:X(p),variables:{cartId:a.cart.id,lines:e,numCartLines:i,country:l}});d&&u({type:"reject",errors:d}),(s=t==null?void 0:t.cartLinesUpdate)!=null&&s.cart&&(v.publish(v.eventNames.UPDATE_CART,!0,{updatedCartLines:e,oldCart:a.cart}),u({type:"resolve",cart:n(t.cartLinesUpdate.cart)}))}},[k,f,p,i,l]),S=y.exports.useCallback(async(e,a)=>{var s;if(a.status==="idle"){u({type:"noteUpdate"}),x==null||x();const{data:t,errors:d}=await f({query:Z(p),variables:{cartId:a.cart.id,note:e,numCartLines:i,country:l}});d&&u({type:"reject",errors:d}),(s=t==null?void 0:t.cartNoteUpdate)!=null&&s.cart&&u({type:"resolve",cart:n(t.cartNoteUpdate.cart)})}},[x,f,p,i,l]),E=y.exports.useCallback(async(e,a)=>{var s;if(a.status==="idle"){u({type:"buyerIdentityUpdate"}),w==null||w();const{data:t,errors:d}=await f({query:B(p),variables:{cartId:a.cart.id,buyerIdentity:e,numCartLines:i,country:l}});d&&u({type:"reject",errors:d}),(s=t==null?void 0:t.cartBuyerIdentityUpdate)!=null&&s.cart&&u({type:"resolve",cart:n(t.cartBuyerIdentityUpdate.cart)})}},[w,f,p,i,l]),T=y.exports.useCallback(async(e,a)=>{var s;if(a.status==="idle"){u({type:"cartAttributesUpdate"}),U==null||U();const{data:t,errors:d}=await f({query:L(p),variables:{cartId:a.cart.id,attributes:e,numCartLines:i,country:l}});d&&u({type:"reject",errors:d}),(s=t==null?void 0:t.cartAttributesUpdate)!=null&&s.cart&&u({type:"resolve",cart:n(t.cartAttributesUpdate.cart)})}},[U,f,p,i,l]),O=y.exports.useCallback(async(e,a)=>{var s;if(a.status==="idle"){u({type:"discountCodesUpdate"}),q==null||q();const{data:t,errors:d}=await f({query:F(p),variables:{cartId:a.cart.id,discountCodes:e,numCartLines:i,country:l}});d&&u({type:"reject",errors:d}),(s=t==null?void 0:t.cartDiscountCodesUpdate)!=null&&s.cart&&(v.publish(v.eventNames.DISCOUNT_CODE_UPDATED,!0,{updatedDiscountCodes:e,cart:t.cartDiscountCodesUpdate.cart}),u({type:"resolve",cart:n(t.cartDiscountCodesUpdate.cart)}))}},[q,f,p,i,l]),z=y.exports.useRef(!1);y.exports.useEffect(()=>{localStorage.getItem(_)&&c.status==="uninitialized"&&!z.current&&(z.current=!0,R(localStorage.getItem(_)))},[R,c]),y.exports.useEffect(()=>{!A||E({countryCode:l,customerAccessToken:h},c)},[c,E,l,h,A]);const M=y.exports.useMemo(()=>{var e,a;return{..."cart"in c?c.cart:{lines:[],attributes:[],...C?n(C):{}},status:c.status,error:"error"in c?c.error:void 0,totalQuantity:"cart"in c&&(a=(e=c==null?void 0:c.cart)==null?void 0:e.totalQuantity)!=null?a:0,cartCreate:j,linesAdd(s){"cart"in c&&c.cart.id?g(s,c):j({lines:s})},linesRemove(s){D(s,c)},linesUpdate(s){V(s,c)},noteUpdate(s){S(s,c)},buyerIdentityUpdate(s){E(s,c)},cartAttributesUpdate(s){T(s,c)},discountCodesUpdate(s){O(s,c)},cartFragment:p}},[c,C,j,p,g,D,V,S,E,T,O]);return $(rt.Provider,{value:M,children:r})}function n(r){var i;return{...r,lines:G(r.lines),note:(i=r.note)!=null?i:void 0}}export{ot as CartProvider};
//# sourceMappingURL=81b6474a.js.map
